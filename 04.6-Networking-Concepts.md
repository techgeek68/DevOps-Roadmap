# 9. Configuring Network

A reference for DevOps engineers on Linux networking, including interface setup, IP addressing, DNS, routing, troubleshooting, firewall integration, cloud networking (AWS, Azure, GCP), automation, and best practices. All commands are grouped by tool, including verification steps, explanations, and cloud scenarios.

---

**9.1 Networking Concepts**

**Network Communication Types**

**1. Unicast (One-to-One)**
 - Definition: One source → One destination
 - Use: Web browsing, SSH, email
 - Example: `192.168.1.10 → 192.168.1.20`

**2. Broadcast (One-to-All)**
 - Definition: One source → All devices in networks
 - Use: ARP, DHCP
 - Example: `192.168.1.10 → 255.255.255.255`

**3. Multicast (One-to-Many)**
 - Definition: One source → Multiple specific devices
 - Use: Video streaming, conferencing
 - IP Range: 224.0.0.0 – 239.255.255.255
 - Example: `192.168.1.10 → 239.255.0.1`

**4. Anycast (One-to-Nearest)**
 - Definition: One source → Nearest of multiple identical destinations
 - Use: DNS servers, CDNs

---

**IP Address**

A unique numerical label assigned to every device on an IP network for identification and routing.

**Types:**
- **IPv4 (Internet Protocol Version 4):**
    - Format: 32-bit, dotted decimal notation
    - Example: `192.168.1.1`
    - Limitation: ~4.3 billion addresses (exhausted)
    
- **IPv6(Internet Protocol Version 6):**
    - Format: 128-bit, hexadecimal notation
    - Example:`2001:0db8:85a3::8a2e:0370:7334`
    - Virtually unlimited addresses

**IP Address Functions:**
- Host Identification: Uniquely identifies each device
- Interface Addressing: Identifies specific network interfaces
- Routing: Enables packet delivery to the correct destinations

**IP Address Categories:**
- Public IP Address:
  - Globally routable on the Internet
  - Allocated by IANA → Regional Internet Registries (RIRs) → ISPs
  - Required for direct Internet access
    
- Private IP Address(RFC 1918)
  - Used within local networks only
  - Not routable on the public Internet
  - Requires NAT (Network Address Translation) for Internet access
    
**- Examples:**
```
10.0.0.0/8        (10.0.0.0 - 10.255.255.255)     - Large organizations
172.16.0.0/12     (172.16.0.0 - 172.31.255.255)   - Medium organizations  
192.168.0.0/16    (192.168.0.0 - 192.168.255.255) - Home/small business
```

<img width="919" height="58" alt="Screenshot 2025-10-28 at 8 19 54 AM" src="https://github.com/user-attachments/assets/fc3d9426-8154-4f33-b20f-a4fe844cca79" />


**Default Gateway**

A router that sends data between different networks, such as from a local network (LAN) to the Internet. It often uses NAT to convert private IP addresses to public ones.

**Functions:**
  - Routes traffic from the local network to external networks (LAN → Internet)
  - Typically performs NAT (Network Address Translation)
  - Serves as the "exit point" from the local network

**Example:**
  - Local device: 192.168.1.100
  - Gateway: 192.168.1.1
  - Internet destination: routed through the gateway

<img width="886" height="202" alt="Screenshot 2025-10-28 at 8 24 17 AM" src="https://github.com/user-attachments/assets/9cdb072c-cd1d-47aa-9dc2-f380c1f823dc" />


**DNS (Domain Name System)**

It’s what helps your computer find websites by turning names like example.com into the numerical addresses computers use to connect, kind of like looking up a contact’s phone number to make a call.

**DNS Components:**
 - Recursive resolver:
     - First point of contact for DNS queries
     - Caches responses for performance
     - Examples:
         - 8.8.8.8 (Google)
         - 1.1.1.1 (Cloudflare)
           
 - Authoritative nameserver:
     - Holds the official DNS records for domains
     - Provides definitive answers for specific domains
     - Managed by domain owners/hosting providers
 
 - DNS Resolution Process:
`Query recursive resolver → 2. Check cache → 3. Query root servers → 4. Query TLD servers → 5. Query authoritative servers → 6. Return IP address`

<img width="778" height="149" alt="Screenshot 2025-10-28 at 8 25 59 AM" src="https://github.com/user-attachments/assets/732c4d65-2791-4bde-b9ca-83d9e7833d66" />

---

**9.2 IPv4 Classful Addressing & Special Ranges**

While modern networks use CIDR (Classless Inter-Domain Routing), understanding historical classful addressing helps interpret legacy systems and documentation.

**Unicast Address Classes (A, B, C):**

These were used for assigning addresses to hosts on the public internet and have corresponding private address blocks defined in RFC 1918.

| **Class** | **First Octet** | **   Public Range        ** | **      Private Range     **  | **Default Mask** | **CIDR** |
| :-------: | :-------------: | :-------------------------: | :--------------------------:  | :--------------: | :------: |
|   **A**   |      1–126      |  1.0.0.0 – 126.255.255.255  |  10.0.0.0 – 10.255.255.255    |    255.0.0.0     |   /8     |
|   **B**   |     128–191     | 128.0.0.0 – 191.255.255.255 | 172.16.0.0 – 172.31.255.255   |   255.255.0.0    |   /16    |
|   **C**   |     192–223     | 192.0.0.0 – 223.255.255.255 | 192.168.0.0 – 192.168.255.255 |  255.255.255.0   |   /24    |

**Special Use Address Classes (D, E) & Notable Reservations**:

These address ranges are reserved for specific protocols and are not used for general host addressing.

| **Class** | **First Octet** | **Address Range** | **Purpose** | **Examples** |
| :-------: | :-------------: | :---------------: | :---------: | :--------------- |
|   **D**   |     224–239     | 224.0.0.0 – 239.255.255.255 | **Multicast** | 224.0.0.1 (All hosts), 224.0.0.2 (All routers) |
|   **E**   |     240–255     | 240.0.0.0 – 255.255.255.255 | **Reserved / Experimental** | 255.255.255.255 (Limited broadcast) |
|  **N/A**  |      **127**    |   127.0.0.0/8     | **Loopback** | 127.0.0.1 (Localhost) |
|  **N/A**  |     **169.254** |   169.254.0.0/16  | **APIPA** | 169.254.x.x (Automatic Private IP Addressing) |
|  **N/A**  |    **192.0.2**  |   192.0.2.0/24    | **TEST-NET** | 192.0.2.1 (Documentation & examples) |

Other reserved ranges:
- 198.51.100.0/24, 203.0.113.0/24 (documentation)
- 100.64.0.0/10 (Carrier Grade NAT)
- 255.255.255.255 (Local broadcast)

---

**9.3 Linux Networking Commands**

**Interface Configuration**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Show all IP addresses** | `hostname -I` | Linux-specific, shows all IPs |
| **Legacy interface info** | `ifconfig` | Deprecated (net-tools package) |
| **Modern interface info** | `ip addr show`<br>`ip a` (shorthand) | Preferred modern method |
| **Interface status** | `ip link show` | Shows link layer status |
| **Bring interface up/down** | `ip link set eth0 up`<br>`ip link set eth0 down` | Replace `eth0` with interface name |
| **Add IP address** | `ip addr add 192.168.1.100/24 dev eth0` | Temporary (lost on reboot) |
| **Remove IP address** | `ip addr del 192.168.1.100/24 dev eth0` | Remove specific IP |
| **Flush all IPs** | `ip addr flush dev eth0` | Remove all IPs from interface |


**Routing & Gateway**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Show routing table** | `ip route show`<br>`ip route` | Modern replacement |
| **Legacy routing table** | `route -n` | Deprecated |
| **Add default gateway** | `ip route add default via 192.168.1.1` | Set default route |
| **Add specific route** | `ip route add 10.0.0.0/8 via 192.168.1.1` | Add network route |
| **Delete route** | `ip route del 10.0.0.0/8` | Remove specific route |
| **Flush routing table** | `ip route flush all` | Clear all routes |


**DNS & Name Resolution**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Show DNS servers** | `cat /etc/resolv.conf` | May be managed by NetworkManager |
| **Test DNS resolution** | `dig example.com A`<br>`dig +short example.com` | Detailed/short output |
| **Simple DNS lookup** | `nslookup example.com` | Legacy but simple |
| **Host lookup** | `host example.com` | Basic DNS query |
| **Flush DNS cache (systemd)** | `systemd-resolve --flush-caches` | systemd-resolved |
| **Flush DNS cache (NetworkManager)** | `sudo systemctl restart NetworkManager` | Alternative method |


**Network Connectivity Testing**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Test reachability** | `ping 8.8.8.8`<br>`ping -c 4 8.8.8.8` | Continuous/limited pings |
| **Trace path** | `traceroute example.com` | Requires root privileges |
| **Rootless trace** | `tracepath example.com` | No root required |
| **HTTP test** | `curl -I http://example.com` | Headers only |
| **Verbose HTTP** | `curl -v http://example.com` | Detailed connection info |
| **Download test** | `wget http://example.com/file` | Download file |


**Network Statistics & Monitoring**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Legacy listening ports** | `netstat -tulnp` | net-tools package |
| **Modern listening ports** | `ss -tulnp` | Faster, iproute2 package |
| **All connections** | `ss -tunap` | All TCP/UDP connections |
| **Interface statistics** | `ip -s link` | Show interface statistics |
| **Network statistics** | `netstat -i` | Interface table |
| **ARP table** | `ip neigh show` | Modern ARP table |
| **Legacy ARP** | `arp -n` | Deprecated ARP table |


**Troubleshooting & Advanced**

| Purpose | Command | Description |
|---------|---------|-------------|
| **Check network manager** | `nmcli device status` | NetworkManager status |
| **Restart networking** | `systemctl restart NetworkManager` | Redhat/Fedora/CentOS |
| **Restart networking** | `systemctl restart networking` | Debian/Ubuntu (ifupdown) |
| **Scan ports** | `nmap -sS 192.168.1.0/24` | Network discovery |
| **Check bandwidth** | `iftop` | Real-time bandwidth (install separately) |
| **Monitor traffic** | `tcpdump -i eth0` | Packet capture |
| **Follow system logs** | `journalctl -f -u NetworkManager` | NetworkManager logs |


**Configuration Files**

| File | Purpose |
|------|---------|
| `/etc/netplan/` | Ubuntu network configuration (YAML) |
| `/etc/network/interfaces` | Debian interface configuration |
| `/etc/sysconfig/network-scripts/` | RedHat/CentOS interface configs |
| `/etc/resolv.conf` | DNS resolver configuration |
| `/etc/hosts` | Local hostname to IP mappings |


**Examples: Essential Commands**

**System overview:**
```bash
ip a                        # Show IP addresses
```
<img width="880" height="249" alt="Screenshot 2025-10-28 at 8 59 18 AM" src="https://github.com/user-attachments/assets/f21d086d-53c7-4ffa-bee5-0a7f0b790116" />

```bash
ip route                    # Show routing table
```

```bash
ss -tulnp                   # Show listening ports
```

<img width="852" height="199" alt="Screenshot 2025-10-28 at 9 01 26 AM" src="https://github.com/user-attachments/assets/0c9b0e56-61d5-4664-bc76-d52f9f2b12ea" />


**Connectivity testing**
```
ping 8.8.8.8           # Basic connectivity
```
<img width="831" height="166" alt="Screenshot 2025-10-28 at 9 04 01 AM" src="https://github.com/user-attachments/assets/3d7c8ea0-e0d0-4d4b-b404-b374e948b121" />

```
dig redhat.com         # DNS resolution test
```
<img width="846" height="631" alt="Screenshot 2025-10-28 at 9 05 56 AM" src="https://github.com/user-attachments/assets/276e963e-ed1d-4d64-9ddb-ad31956c2836" />

<img width="837" height="341" alt="Screenshot 2025-10-28 at 9 05 35 AM" src="https://github.com/user-attachments/assets/4f73fc82-7fde-4dc8-90af-70d747b7de08" />

```
curl -I example.com    # HTTP service test
```

<img width="995" height="190" alt="Screenshot 2025-10-28 at 9 08 13 AM" src="https://github.com/user-attachments/assets/950ae728-2bd0-4852-9b7d-4f1c59b9d70f" />


**Temporary configuration**
```
ip addr add 192.168.xxx.xxx/xx dev exxxx                 # Add IP
ip link set exxxx up                                     # Enable interface
ip route add default via 192.168.xxx.xx                  # Add gateway
```

Example:

<img width="918" height="569" alt="Screenshot 2025-10-28 at 9 31 30 AM" src="https://github.com/user-attachments/assets/6de30bea-f948-451e-afc2-6f04983588e9" />

---

**9.4 Network Interface Configuration**

**Using `ifconfig` (Legacy - Avoid in New Systems)**
```bash
ifconfig                                              # List all interfaces
ifconfig eth0                                         # Show specific interface
ifconfig eth0 up                                      # Bring interface up
ifconfig eth0 down                                    # Bring interface down
ifconfig eth0 192.168.1.100 netmask 255.255.255.0     # Set IP and netmask
ifconfig eth0:0 192.168.1.101/24                      # Add alias interface
```
> Part of the deprecated net-tools package. Not recommended for new scripts.

**Using `ip` command (Modern-Preferred)**
```bash
# Interface management
ip link show                                        # Show all interfaces
ip link set eth0 up                                 # Bring interface up
ip link set eth0 down                               # Bring interface down

# IP address management
ip addr show                                        # Show all IP addresses
ip addr add 192.168.1.100/24 dev eth0               # Add IP address
ip addr del 192.168.1.100/24 dev eth0               # Remove IP address
ip addr flush dev eth0                              # Remove all IPs from interface

# Brief output formats
ip -br link show                                    # Brief interface status
ip -br addr show                                    # Brief IP address summary
```

> `ip` commands are temporary and don't persist after reboot.
>  Always use `ip` for scripting and automation unless supporting legacy systems.

---

**9.5 Configuring IP, Gateway, DNS (Persistent Configuration)**

**Method 1: NetworkManager CLI (nmcli)**
```bash
# View current connections
nmcli connection show
nmcli device status

# Configure static IP
nmcli connection modify "eth0" ipv4.addresses "192.168.1.100/24"
nmcli connection modify "eth0" ipv4.gateway "192.168.1.1"
nmcli connection modify "eth0" ipv4.dns "8.8.8.8,8.8.4.4"
nmcli connection modify "eth0" ipv4.method manual

# Apply changes
nmcli connection up "eth0"
nmcli connection reload    # Reload all connections

# Create new connection
nmcli connection add type ethernet con-name "static-eth0" ifname eth0 \
  ipv4.addresses "192.168.1.100/24" \
  ipv4.gateway "192.168.1.1" \
  ipv4.dns "8.8.8.8" \
  ipv4.method manual
```

**Method 2: Netplan (Ubuntu 18.04+)**

- File: `/etc/netplan/01-netcfg.yaml`
  
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 192.168.1.100/24
      routes:
        - to: default
          via: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```

Apply netplan configuration:
```bash
netplan generate
netplan apply
```

**Method 3: Legacy System Configuration (RHEL/CentOS 7 and earlier)**

 - File: `/etc/sysconfig/network-scripts/ifcfg-eth0`
   
```ini
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=8.8.8.8
DNS2=8.8.4.4
```

Restart service
```bash
systemctl restart network
```

**Method 4: systemd-networkd (Modern minimal distributions)**

 - File: `/etc/systemd/network/10-eth0.network`
   
```ini
[Match]
Name=eth0

[Network]
Address=192.168.1.100/24
Gateway=192.168.1.1
DNS=8.8.8.8
DNS=8.8.4.4
```

Enable and start:
```bash
systemctl enable systemd-networkd
systemctl start systemd-networkd
```

**NetworkManager Example (CentOS Stream 9+)**

 - Generate UUID: `uuidgen`
 - File: `cd /etc/NetworkManager/system-connections`
          
   
```ini
[connection]
id=static-enp
uuid=45882b4c-314c-11f0-bb1a-5254000dc1ee
type=ethernet
interface-name=enp0s1
autoconnect=true

[ipv4]
method=manual
addresses=192.168.100.199/24;
gateway=192.168.100.1
dns=192.168.100.1

[ipv6]
method=ignore
```
Apply:
```bash
nmcli connection reload
nmcli connection show
nmcli connection up static-enp
ip addr show enp0s1
```

Finding DNS, Gateway:

<img width="753" height="199" alt="Screenshot 2025-10-28 at 11 23 50 AM" src="https://github.com/user-attachments/assets/a830d7da-cc7c-47ec-9519-c3bc8edc77c8" />

Generating UUID:

<img width="778" height="60" alt="Screenshot 2025-10-28 at 11 25 06 AM" src="https://github.com/user-attachments/assets/9dee570c-5b83-4cfe-9ef4-7c3da29cb79f" />

Editing file: `vim xxxxxxx.nmconnection`
<img width="780" height="375" alt="Screenshot 2025-10-28 at 11 32 34 AM" src="https://github.com/user-attachments/assets/ab110e94-4c6e-44b8-aca1-63416d236ea4" />

<img width="708" height="65" alt="Screenshot 2025-10-28 at 11 37 54 AM" src="https://github.com/user-attachments/assets/196a14dc-d3b9-458e-b251-0d79f42fa60e" />

<img width="1014" height="259" alt="Screenshot 2025-10-28 at 11 35 19 AM" src="https://github.com/user-attachments/assets/9dff65bc-f515-4b0b-8923-70388e0ff4e5" />

<img width="1035" height="166" alt="Screenshot 2025-10-28 at 11 35 50 AM" src="https://github.com/user-attachments/assets/05786fb9-dce4-4cfa-a9b2-8c92575756fa" />

---

**9.6 DNS Details**

Viewing DNS Configuration:
```bash
cat /etc/resolv.conf                    # Current DNS resolvers
resolvectl status                       # systemd-resolved status
nmcli device show eth0 | grep DNS       # NetworkManager DNS
```

Common DNS Resolvers:
```
nameserver 8.8.8.8          # Google DNS
nameserver 8.8.4.4          # Google DNS secondary
nameserver 1.1.1.1          # Cloudflare DNS
nameserver 192.168.1.1      # Local router/gateway
```
> Use multiple DNS resolvers for redundancy. Monitor DNS query latency.


Managing DNS Cache:
```bash
# systemd-resolved
systemd-resolve --flush-caches
systemctl restart systemd-resolved

# Alternative methods
sudo systemctl restart NetworkManager    # Restart NetworkManager
```

Local Hostname Resolution:
 - File: `/etc/hosts`
```
127.0.0.1   localhost localhost.localdomain
192.168.1.10  server1.example.com server1
192.168.1.20  server2.example.com server2
```

<img width="763" height="161" alt="Screenshot 2025-10-28 at 12 40 37 PM" src="https://github.com/user-attachments/assets/6b1ba758-c1ed-48c1-8e17-9a78eb8d1c2d" />


---


**9.7 Routing & Gateway**

Viewing Routing Table:
```bash
ip route show              # Modern command
route -n                   # Legacy command
ip route get 8.8.8.8       # Show route for specific destination
```

<img width="782" height="78" alt="Screenshot 2025-10-28 at 12 42 39 PM" src="https://github.com/user-attachments/assets/3e94eae5-4189-43ba-bb72-c6978120977d" />

**Managing Routes:**
 
Example:
```bash
# Add default gateway (temporary)
ip route add default via 192.168.1.1 dev eth0

# Add specific network route (temporary)
ip route add 10.0.0.0/8 via 192.168.1.254 dev eth0

# Delete routes
ip route del default
ip route del 10.0.0.0/8

# Persistent routing (RHEL/CentOS)
echo "10.0.0.0/8 via 192.168.1.254 dev eth0" >> /etc/sysconfig/network-scripts/route-eth0
```

---

**9.8 Network Troubleshooting**


| Symptom | Diagnostic Steps | Possible Cause | Resolution |
|---------|------------------|----------------|------------|
| **No connectivity (ping fails)** | `ip addr show`<br>`ip link show`<br>`ping <gateway>`<br>`ethtool <interface>` | Interface down<br>Wrong IP/subnet<br>Cable disconnected<br>Driver issues | `ip link set <iface> up`<br>Correct IP configuration<br>Check physical connections<br>Update drivers |
| **DNS fails, IP works** | `ping 8.8.8.8` (works)<br>`ping example.com` (fails)<br>`nslookup example.com`<br>`cat /etc/resolv.conf` | DNS server misconfigured<br>DNS service down<br>Firewall blocking DNS | Update DNS in NetworkManager<br>Check `systemd-resolved` status<br>Adjust firewall rules |
| **Cannot reach outside subnet** | `ip route show`<br>`ping <gateway>`<br>`traceroute 8.8.8.8` | Missing default route<br>Gateway unreachable<br>Wrong subnet mask | `ip route add default via <gateway>`<br>Verify gateway IP<br>Check subnet configuration |
| **Slow DNS resolution** | `dig +trace example.com`<br>`time nslookup example.com`<br>`resolvectl statistics` | DNS server latency<br>DNS cache issues<br>Network congestion | Change to faster resolvers<br>Flush DNS cache<br>Use local caching resolver |
| **Port unreachable** | `ss -tulnp \| grep :port`<br>`sudo firewall-cmd --list-all`<br>`systemctl status <service>` | Service not listening<br>Firewall blocking<br>Wrong bind address | Start/restart service<br>Add firewall exception<br>Check service configuration |
| **Random IP after boot (169.254.x.x)** | `ip addr show`<br>`journalctl -u NetworkManager`<br>`dhclient -v` | DHCP failure<br>Network cable issue<br>Switch port blocked | Check DHCP server<br>Verify physical connectivity<br>Manual static IP assignment |
| **Duplicate IP conflict** | `arping -c 3 <IP>`<br>`journalctl \| grep -i arp`<br>`ip neigh show` | Multiple devices with same IP<br>Static IP in DHCP range<br>Rogue DHCP server | Assign unique static IP<br>Exclude static IPs from DHCP range<br>Network segmentation |


**Advanced Diagnostic Commands**

**Connectivity Testing Sequence**
```bash
# 1. Check local interface
ip -br addr show

# 2. Test local network
ping -c 3 <gateway_ip>

# 3. Test internet
ping -c 3 8.8.8.8

# 4. Test DNS
nslookup google.com
dig google.com

# 5. Check specific service
telnet <server> <port>
nc -zv <server> <port>
```

**Network Service Status**
```bash
# Check relevant services
systemctl status NetworkManager
systemctl status systemd-resolved
systemctl status firewalld
systemctl status iptables

# Restart if needed
sudo systemctl restart NetworkManager
```

**Packet Capture & Analysis**
```bash
# Basic packet capture
tcpdump -i eth0 -n host 8.8.8.8

# Capture DNS queries
tcpdump -i eth0 -n port 53

# Save to file for analysis
tcpdump -i eth0 -w capture.pcap
```

---

**Common Resolution Steps**

**Quick Network Reset**
```bash
# Restart networking (RHEL/CentOS)
sudo systemctl restart NetworkManager

# Restart networking (Ubuntu with netplan)
sudo netplan apply

# Flush all temporary configurations
sudo ip addr flush dev eth0
sudo ip route flush all
```

**DNS Troubleshooting**
```bash
# Test different DNS servers
nslookup google.com 8.8.8.8
nslookup google.com 1.1.1.1

# Flush DNS cache (systemd)
sudo systemd-resolve --flush-caches

# Check DNS resolution path
dig +trace google.com
```


---


**9.9 Cloud Networking Basics (AWS, Azure, GCP)**

**AWS VPC & Security Groups**

**VPC Creation & Subnetting:**
```bash
aws ec2 create-vpc --cidr-block 10.0.0.0/16
aws ec2 create-subnet --vpc-id vpc-1234abcd --cidr-block 10.0.1.0/24
```

**Security Group Rules:**
```bash
aws ec2 describe-security-groups
aws ec2 authorize-security-group-ingress --group-id sg-12345678 --protocol tcp --port 22 --cidr 203.0.113.0/24
aws ec2 revoke-security-group-ingress --group-id sg-12345678 --protocol tcp --port 22 --cidr 0.0.0.0/0
```


>Restrict security group rules by CIDR. Avoid using wide-open routes (0.0.0.0/0) unless absolutely required for testing purposes.


**Azure Networking & Network Security Groups (NSG)**

**Create NSG Rule:**
```bash
az network nsg rule create \
  --resource-group myResourceGroup \
  --nsg-name myNSG \
  --name AllowSSH \
  --protocol tcp \
  --direction inbound \
  --priority 1000 \
  --source-address-prefixes '203.0.113.0/24' \
  --destination-port-ranges 22 \
  --access Allow
```

**List NSG Rules:**
```bash
az network nsg rule list --resource-group myResourceGroup --nsg-name myNSG
```


> Always set a specific source address/range, avoid '*' in production.



**GCP VPC & Firewall Rules**

**Create Firewall Rule:**
```bash
gcloud compute firewall-rules create allow-ssh \
  --direction=INGRESS \
  --priority=1000 \
  --network=default \
  --action=ALLOW \
  --rules=tcp:22 \
  --source-ranges=203.0.113.0/24
```

**List Firewall Rules:**
```bash
gcloud compute firewall-rules list
```


> Use restrictive source ranges. Audit rules regularly.


---


**9.10 Container & Kubernetes Networking**

**Docker**

- Expose container port:
```bash
docker run -d -p 8080:8080 myapp
```

- Verification:
```bash
curl localhost:8080
ss -tulnp | grep 8080
```

**Kubernetes**

- Simple NetworkPolicy example:
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-nginx
spec:
  podSelector:
    matchLabels:
      app: nginx
  ingress:
    - from:
        - ipBlock:
            cidr: 10.0.0.0/24
```

- Verification:
```bash
kubectl describe networkpolicy allow-nginx
```

> Use least-privilege policies—only allow required ports and traffic between containers/pods.


---


**9.11 Infrastructure as Code (IaC) for Networking**

**Example: Terraform AWS Security Group**

```hcl
resource "aws_security_group" "web" {
  name        = "web-sg"
  description = "Allow HTTP and SSH"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["203.0.113.0/24"]
  }
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```

- Verification:
```bash
terraform plan
terraform apply
aws ec2 describe-security-groups
```

**Example: Terraform Azure NSG**
```hcl
resource "azurerm_network_security_group" "example" {
  name                = "example-nsg"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  security_rule {
    name                       = "AllowSSH"
    priority                   = 1000
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "Tcp"
    source_port_range          = "*"
    destination_port_range     = "22"
    source_address_prefix      = "203.0.113.0/24"
    destination_address_prefix = "*"
  }
}
```

- Verification:
```bash
terraform plan
terraform apply
az network nsg rule list --resource-group <resource-group> --nsg-name example-nsg
```

**Example: Terraform GCP Firewall Rule**
```hcl
resource "google_compute_firewall" "allow_ssh" {
  name    = "allow-ssh"
  network = "default"

  allow {
    protocol = "tcp"
    ports    = ["22"]
  }

  source_ranges = ["203.0.113.0/24"]
  direction     = "INGRESS"
  priority      = 1000
}
```

- Verification:
```bash
terraform plan
terraform apply
gcloud compute firewall-rules list
```


> Store all networking resources in version control and review via PR before deployment.


---

**9.12 Monitoring & Troubleshooting**

**Linux**

- **Ping:** `ping 8.8.8.8`
- **Traceroute:** `traceroute example.com`
- **Socket state:** `ss -tulnp`
- **Firewall check:** `firewall-cmd --list-all`
- **System logs:** `journalctl -u NetworkManager`, `dmesg | grep eth`

**Cloud**

- **AWS CloudWatch:** Monitor VPC flow logs.
- **Azure Monitor:** NSG flow logs.
- **GCP Logging:** VPC flow logs.


> Aggregate logs and alerts centrally (e.g., ELK, Datadog, Splunk).


---


**9.13 Cleanup & Reversion**

If you added a temporary IP:
```bash
ip addr del 192.168.1.100/24 dev eth0
```

If you opened a firewall port (firewalld) for testing:
```bash
firewall-cmd --zone=public --remove-port=8080/tcp --permanent
firewall-cmd --reload
```

If you modified a NetworkManager connection incorrectly:
```bash
nmcli connection reload
nmcli connection modify eth0 ipv4.method auto
nmcli connection up eth0
```


---

**9.14 Legacy vs Modern**

| Function | Legacy Tool(s) | Modern Preferred |
|----------|----------------|------------------|
| Interface management | `ifconfig` | `ip addr`, `ip link` |
| Routes | `route` | `ip route` |
| Sockets | `netstat` | `ss` |
| Firewall | `iptables` | `firewalld` (nftables) |
| DNS Query | `nslookup` | `dig`, `getent hosts` |


---

**9.15 References**

- RFC 1918 – Address Allocation for Private Internets
- RFC 5735 / 6890 – Special Use IPv4 Addresses
- `man ip`, `man nmcli`, `man firewalld.richlanguage`
- Linux Advanced Routing & Traffic Control HOWTO
- [AWS VPC Documentation](https://docs.aws.amazon.com/vpc/latest/userguide/)
- [Azure VNet Documentation](https://docs.microsoft.com/en-us/azure/virtual-network/)
- [GCP VPC Documentation](https://cloud.google.com/vpc/docs)
- [Docker Networking](https://docs.docker.com/network/)
- [Kubernetes Networking](https://kubernetes.io/docs/concepts/cluster-administration/networking/)
- [Terraform Networking](https://developer.hashicorp.com/terraform/tutorials/aws/aws-networking)

---
